<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>GymTrack - Registro y Login</title>
    <link rel="stylesheet" href="/css/estilos.css">
    <style>
        /* Estilos m√≠nimos (puedes usar tu CSS existente) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #c1e1ff, #f7f9fc);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .card { background: white; border-radius: 18px; display:flex; overflow:hidden; width:800px; max-width:95%; box-shadow:0 8px 24px rgba(0,0,0,0.1); }
        .card-left, .card-right { padding: 40px; width:50%; }
        .card-right { background: url('/images/motivacion.jpg') no-repeat center center; background-size:cover; color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        h2 { color:#0077cc; margin-bottom:20px; }
        form input { width:100%; padding:12px 15px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc; font-size:1em; box-sizing: border-box; }
        .password-container { position:relative; }
        /* aseguramos espacio para el bot√≥n dentro del input */
        .password-container input { padding-right:48px; }
        .toggle-password-btn { position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; font-size:1.2em; background:none; border:none; color:#666; }
        .btn { background-color:#0077cc; color:white; padding:12px 28px; border-radius:10px; font-weight:bold; border:none; cursor:pointer; }
        .invalid-feedback { color:red; font-size:0.85em; margin-top:-5px; margin-bottom:5px; text-align:left; }
        input.is-valid { border-color:#28a745; }
        input.is-invalid { border-color:#dc3545; }
        .server-message { padding:12px; border-radius:8px; margin-bottom:12px; }
        .server-error { background:#ffe6e6; color:#7a1a1a; border:1px solid #f5c2c2; }
        .server-success { background:#e6fff0; color:#0b5d2b; border:1px solid #bfeccf; }
        .link { font-size:0.9em; color:#0077cc; cursor:pointer; text-decoration:underline; }
    </style>
</head>
<body>

<div class="card form-section active" id="registro-section" style="display:flex;">
    <div class="card-left">
        <h2>Registro</h2>

        <!-- Mensajes del servidor (mostrar solo si no est√°n vac√≠os) -->
        <div th:if="${error != null and error != ''}" class="server-message server-error" th:text="${error}"></div>
        <div th:if="${exito != null and exito != ''}" class="server-message server-success" th:text="${exito}"></div>

        <!-- Formulario de registro: POST a /registro (controlador web) -->
        <form id="register-form" th:action="@{/registro}" method="post" onsubmit="return validarFormularioRegistro()">
            <input type="text" name="nombre" id="register-nombre" placeholder="Nombre de usuario" required>
            <input type="email" name="email" id="register-email" placeholder="Correo electr√≥nico" required>

            <div class="password-container">
                <input type="password" name="password" id="register-password" placeholder="Contrase√±a" required autocomplete="new-password">
                <!-- bot√≥n accesible, con icono; usar bot√≥n para accesibilidad -->
                <button type="button" class="toggle-password-btn" aria-label="Mostrar u ocultar contrase√±a"></button>
            </div>

            <input type="date" name="fechaNacimiento" id="register-fechaNacimiento" placeholder="Fecha de nacimiento" required>
            <button type="submit" class="btn">Registrarse</button>
        </form>

        <p class="link" onclick="mostrarLogin()">¬øYa tienes cuenta? Inicia sesi√≥n</p>
        <p class="link" onclick="mostrarRecuperar()">¬øOlvidaste tu contrase√±a?</p>
    </div>

    <div class="card-right">
        <h2>¬°Alcanza tus metas!</h2>
        <p>Empieza tu viaje hacia un estilo de vida m√°s saludable y motivador. Cada d√≠a cuenta y aqu√≠ te apoyamos en cada paso.</p>
    </div>
</div>

<!-- Login (oculto por defecto) -->
<div class="card form-section" id="login-section" style="display:none;">
    <div class="card-left">
        <h2>Login</h2>
        <form id="login-form" th:action="@{/login}" method="post">
            <input type="email" name="email" id="login-email" placeholder="Correo electr√≥nico" required>
            <div class="password-container">
                <input type="password" name="password" id="login-password" placeholder="Contrase√±a" required>
                <button type="button" class="toggle-password-btn" title="Mostrar/Ocultar contrase√±a">üëÅÔ∏è</button>
            </div>
            <button type="submit" class="btn">Ingresar</button>
        </form>
        <p class="link" onclick="mostrarRegistro()">¬øNo tienes cuenta? Reg√≠strate</p>
        <p class="link" onclick="mostrarRecuperar()">¬øOlvidaste tu contrase√±a?</p>
    </div>
    <div class="card-right">
        <h2>¬°Bienvenido de nuevo!</h2>
        <p>Inicia sesi√≥n para continuar con tu seguimiento personalizado y motivarte d√≠a a d√≠a.</p>
    </div>
</div>

<!-- Recuperar contrase√±a (oculto por defecto) -->
<div class="card form-section" id="recuperar-section" style="display:none;">
    <div class="card-left">
        <h2>Recuperar contrase√±a</h2>
        <form id="recuperar-form" th:action="@{/recuperar}" method="post">
            <input type="email" name="email" id="recuperar-email" placeholder="Correo electr√≥nico" required>
            <button type="submit" class="btn">Enviar enlace de recuperaci√≥n</button>
        </form>
        <p class="link" onclick="mostrarLogin()">Volver al login</p>
        <p class="link" onclick="mostrarRegistro()">¬øNo tienes cuenta? Reg√≠strate</p>
    </div>
    <div class="card-right">
        <h2>¬°No te preocupes!</h2>
        <p>Recupera tu acceso f√°cilmente y vuelve a retomar tu progreso.</p>
    </div>
</div>

<script src="/js/validacionesRegistro.js"></script>
<script>
    // Ajustar fecha m√°xima: m√≠nimo 16 a√±os
    (function(){
        const fechaNacimiento = document.getElementById('register-fechaNacimiento');
        if(fechaNacimiento){
            const hoy = new Date();
            hoy.setFullYear(hoy.getFullYear() - 16);
            fechaNacimiento.max = hoy.toISOString().split('T')[0];
        }
    })();

    // Mostrar/Ocultar secciones
    function mostrarRegistro() {
        document.getElementById('registro-section').style.display = 'flex';
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('recuperar-section').style.display = 'none';
    }
    function mostrarLogin() {
        document.getElementById('registro-section').style.display = 'none';
        document.getElementById('login-section').style.display = 'flex';
        document.getElementById('recuperar-section').style.display = 'none';
    }
    function mostrarRecuperar() {
        document.getElementById('registro-section').style.display = 'none';
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('recuperar-section').style.display = 'flex';
    }

    // Toggle contrase√±a (delegado para ambos formularios)
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.toggle-password-btn').forEach(function(toggle){
            const container = toggle.parentElement;
            const input = container.querySelector('input[type="password"], input[type="text"]');
            if (!input) return;


            toggle.addEventListener('click', function(){
                input.type = input.type === 'password' ? 'text' : 'password';
                refreshIcon();
                input.focus();
            });

            input.addEventListener('input', refreshIcon);
        });
    });
</script>

</body>
</html>